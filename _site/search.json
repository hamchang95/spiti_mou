[
  {
    "objectID": "map_crime.html",
    "href": "map_crime.html",
    "title": "London Crime Map",
    "section": "",
    "text": "Code\n#--Install / load packages\nrm(list = ls())\npacman::p_load(sf, here, tmap, osmdata, tidyverse, data.table, rio, tidyverse, flextable, mapview, units, spdep, deldir, sp, rgeoda, leaflet, viridis, crosstalk, leaflet.extras, plotly)\n#--Import street-level crime data\ncrime &lt;- readRDS(here(\"3_output\", \"crime_ldn_2023-06_2024-05.RDS\")) |&gt;\n    dplyr::mutate(category = stringr::str_replace_all(category, \"-\", \" \")) |&gt;\n    sf::st_as_sf(coords = c(\"location.longitude\", \"location.latitude\"), crs = 4326, dim = \"XY\") |&gt;\n    mutate(date = ym(month))\n    #from 2023-06 to 2024-05\n\n#--Import boundary \nldn &lt;- st_read(here(\"1_data\", \"9_geo\", \"London_Borough_Excluding_MHW.shp\")) |&gt;\n    st_transform(4326)\n#&gt; Reading layer `London_Borough_Excluding_MHW' from data source \n#&gt;   `C:\\Users\\Hannah.Chang\\spiti_mou_website\\1_data\\9_geo\\London_Borough_Excluding_MHW.shp' \n#&gt;   using driver `ESRI Shapefile'\n#&gt; Simple feature collection with 33 features and 7 fields\n#&gt; Geometry type: MULTIPOLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9\n#&gt; Projected CRS: OSGB36 / British National Grid\n\n#--Create sh_crime\nsh_crime &lt;- SharedData$new(crime)"
  },
  {
    "objectID": "map_crime.html#set-up",
    "href": "map_crime.html#set-up",
    "title": "London Crime Map",
    "section": "",
    "text": "Code\n#--Install / load packages\nrm(list = ls())\npacman::p_load(sf, here, tmap, osmdata, tidyverse, data.table, rio, tidyverse, flextable, mapview, units, spdep, deldir, sp, rgeoda, leaflet, viridis, crosstalk, leaflet.extras, plotly)\n#--Import street-level crime data\ncrime &lt;- readRDS(here(\"3_output\", \"crime_ldn_2023-06_2024-05.RDS\")) |&gt;\n    dplyr::mutate(category = stringr::str_replace_all(category, \"-\", \" \")) |&gt;\n    sf::st_as_sf(coords = c(\"location.longitude\", \"location.latitude\"), crs = 4326, dim = \"XY\") |&gt;\n    mutate(date = ym(month))\n    #from 2023-06 to 2024-05\n\n#--Import boundary \nldn &lt;- st_read(here(\"1_data\", \"9_geo\", \"London_Borough_Excluding_MHW.shp\")) |&gt;\n    st_transform(4326)\n#&gt; Reading layer `London_Borough_Excluding_MHW' from data source \n#&gt;   `C:\\Users\\Hannah.Chang\\spiti_mou_website\\1_data\\9_geo\\London_Borough_Excluding_MHW.shp' \n#&gt;   using driver `ESRI Shapefile'\n#&gt; Simple feature collection with 33 features and 7 fields\n#&gt; Geometry type: MULTIPOLYGON\n#&gt; Dimension:     XY\n#&gt; Bounding box:  xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9\n#&gt; Projected CRS: OSGB36 / British National Grid\n\n#--Create sh_crime\nsh_crime &lt;- SharedData$new(crime)"
  },
  {
    "objectID": "map_crime.html#spatio-temporal-distribution-of-crimes-by-category",
    "href": "map_crime.html#spatio-temporal-distribution-of-crimes-by-category",
    "title": "London Crime Map",
    "section": "Spatio-Temporal Distribution of Crimes by Category",
    "text": "Spatio-Temporal Distribution of Crimes by Category\n\nMap by Category\n\n\nCode\n#--Assign colour palette\nn_pal &lt;- length(unique(crime$category))\ncrime_pal &lt;- leaflet::colorFactor(turbo(n_pal), crime$category)\n\n#--Create filters\nmonth_slider &lt;- crosstalk::filter_slider(\"date\", \"Date\", sh_crime, ~date, width = \"100%\")\ncategory_checkbox &lt;- crosstalk::filter_checkbox(\"category\", \"Category\", sh_crime, ~category)\n\n#--Create map\nm_eda &lt;- leaflet(sh_crime) |&gt;\n  leaflet::addProviderTiles(\"CartoDB.Positron\")|&gt;\n  leaflet::addCircleMarkers(color = ~crime_pal(category), radius = 2) |&gt;\n  leaflet::addLegend(\"bottomright\", pal = crime_pal, values = ~category, title = \"Category\")\n\n#--Pull everything together\ncrosstalk::bscols(\n  widths = c(12, 3, 9),\n  month_slider,\n  category_checkbox,\n  m_eda\n)\n\n\n\n\n\n\nDate\n\n\n\n\n\n\nCategory\n\n\n\n\nanti social behaviour\n\n\n\n\n\nbicycle theft\n\n\n\n\n\nburglary\n\n\n\n\n\ncriminal damage arson\n\n\n\n\n\ndrugs\n\n\n\n\n\nother crime\n\n\n\n\n\nother theft\n\n\n\n\n\npossession of weapons\n\n\n\n\n\npublic order\n\n\n\n\n\nrobbery\n\n\n\n\n\nshoplifting\n\n\n\n\n\ntheft from the person\n\n\n\n\n\nvehicle crime\n\n\n\n\n\nviolent crime\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTrend by Category\n\n\nCode\n#--Create timeseries data by category\nct_crime &lt;- crime |&gt;\n    st_drop_geometry() |&gt;\n    group_by(category, date) |&gt;\n    tally() |&gt;\n    arrange(desc(n))\n\n#--Create sh_crime\nsh_crime_ct &lt;- SharedData$new(ct_crime)\n\n#--Create filter\nmonth_slider_ct &lt;- crosstalk::filter_slider(\"date\", \"Date\", sh_crime_ct, ~date, step = 1, width = \"100%\")\n\n#--Trend plot\npl_trend &lt;- plotly::plot_ly(sh_crime_ct, x = ~date, y = ~n, color = ~category, colors = viridis_pal(option = \"H\")(14)) |&gt;\n  plotly::add_lines() |&gt;\n  plotly::layout(xaxis = list(title = \"\"),\n                 yaxis = list(title = \"Number of Crimes\\n\"))\n\n#--Pull everything together\ncrosstalk::bscols(\n  widths = c(12, 12),\n  month_slider_ct,\n  pl_trend\n)\n\n\n\n\n\n\nDate\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nOverall Frequency\n\nIn the last 12 months\n\n\nCode\n#--Create count data by category\nct_crime2 &lt;- crime |&gt;\n    st_drop_geometry() |&gt;\n    group_by(category) |&gt;\n    tally() |&gt;\n    arrange(desc(n)) \n\n#--Frequency plot\npl_freq &lt;- plot_ly(ct_crime2, x = ~stats::reorder(category, n, decreasing = TRUE), y = ~n, color = ~category, colors = viridis_pal(option = \"H\")(14)) |&gt;\n  plotly::add_bars()|&gt;\n  plotly::layout(xaxis = list(title = \"\"),\n                 yaxis = list(title = \"Number of Crimes\\n\"))\n\npl_freq"
  }
]